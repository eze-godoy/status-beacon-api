name: Pre-commit Auto-Update

on:
  schedule:
    - cron: '0 7 * * 1'
  workflow_dispatch:

jobs:
  auto-update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.13
        uses: actions/setup-python@v5
        with:
          python-version: '3.13'

      - name: Install pre-commit
        run: pip install pre-commit

      - name: Run pre-commit autoupdate
        run: pre-commit autoupdate

      - name: Create Pull Request
        id: create-pr
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: pre-commit-autoupdate
          delete-branch: true
          title: 'chore: update pre-commit hooks'
          commit-message: 'chore: update pre-commit hooks to latest versions'
          body: |
            ## Pre-commit Hook Updates

            This PR updates pre-commit hooks to their latest versions.

            ### What to Review
            - Check the version changes in `.pre-commit-config.yaml`
            - Ensure CI checks pass
            - Review any breaking changes in the linked release notes

            ---

            ðŸ¤– **Generated by GitHub Actions** - Scheduled weekly on Mondays at 7:00 AM UTC

            ðŸ“ You can also trigger this workflow manually from the [Actions tab](../../actions/workflows/pre-commit-autoupdate.yml)
          labels: dependencies,automated
          assignees: ${{ github.repository_owner }}

      - name: Generate Summary
        run: |
          echo "# Pre-commit Auto-Update Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ "${{ steps.create-pr.outputs.pull-request-number }}" != "" ]; then
            echo "## âœ… Updates Available" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Next Steps:" >> $GITHUB_STEP_SUMMARY
            echo "1. Review the changes in the [pull request](${{ steps.create-pr.outputs.pull-request-url }})" >> $GITHUB_STEP_SUMMARY
            echo "2. Check that CI tests pass" >> $GITHUB_STEP_SUMMARY
            echo "3. Merge the PR to apply updates" >> $GITHUB_STEP_SUMMARY
          else
            echo "## â„¹ï¸ No Updates Required" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "All pre-commit hooks are already up to date! ðŸŽ‰" >> $GITHUB_STEP_SUMMARY
          fi
